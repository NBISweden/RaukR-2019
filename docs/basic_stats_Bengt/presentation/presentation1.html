<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
  <head>
    <title>Basic Statistics part</title>
    <meta charset="utf-8" />
    <meta name="author" content="Bengt Sennblad" />
    <meta name="keywords" content="r, RaukR, markdown" />
    <link href="libs/font-awesome-5.1.0/css/all.css" rel="stylesheet" />
    <link href="libs/font-awesome-5.1.0/css/v4-shims.css" rel="stylesheet" />
    <link id="font-awesome-1-attachment" rel="attachment" href="libs/font-awesome-5.1.0/fonts/fontawesome-webfont.ttf"/>
    <link rel="stylesheet" href="assets/presentation.css" type="text/css" />
  </head>
  <body>
    <textarea id="source">
class: center, middle, inverse, title-slide

# Basic Statistics part
## RaukR 2019 â€¢ Advanced R for Bioinformatics
### <b>Bengt Sennblad</b>
### NBIS, SciLifeLab

---

exclude: true
count: false


&lt;link href="https://fonts.googleapis.com/css?family=Roboto|Source+Sans+Pro:300,400,600|Ubuntu+Mono&amp;amp;subset=latin-ext" rel="stylesheet"&gt;





&lt;!-- ----------------- Only edit title &amp; author above this ----------------- --&gt;


---
name: contents

## Contents

* [Introduction](#intro)

---
name: disposition

##disposition -- the real basics

* models -&gt; stat models
* Use of stat models (type example linear regression)
  + simulation of data
      - variation
      - distribution
  + Probabilities of outcome
      - What are probabilities
      - conditional on model
      - full prob, conditional probs, likelihood, post probs-- Bayes theorem?
          * Bayesian and frequentists (not XOR!)
* Statistical tests
  + parametric (linear regression?)
  + non-parametric (GSEA?)
 
  
---
name: brainstorm

Things that may or may not be treated (preferably in a separate session)
  - multivariate linear models
  - confounders?
  - GLM, LMM 
  - sensitivity specificity ROC
  - PCA etc?
  
Things that would be very handy to have an intuition about for the exercise:
  - Matrix algebra version of linear model (e.g., for simulation exercise)
  - sampling from a distribution (rnorm, but what happens etc)
      
    

---
name: models1
## Models

* What is a model?

--
  + simplification (abstraction) of reality that helps us address a specific problem
  
---
## Models | `Example: R proficiency as a function of beer`
.pull-left-50[
We want to model how beer consumption affects the ability to program well in R

* `\(x\)` number of beers drunk
* `\(y\)` Ability to program in R
]

--
.pull-right-50[
&lt;img src="presentation1_files/figure-html/beer1-1.svg" style="display: block; margin: auto auto auto 0;" /&gt;

]

--
This is a *linear model*, `$$y = kx+c,$$` where `\(y\)` changes in proportion to `\(x\)`.

***

--
__Notice that a model is always restricted by its assumptions:__
* In the model plot above, I have used strong assumptions about `\(k\)` and `\(c\)` being exactly `\(k=-0.1\)` and `\(c=1.0\)`. 
* Therefore, people with a different susceptibility to alcohol `\((k \neq -0.1)\)` or a different initial proficiency in R `\((c \neq 1.0)\)` are *not* correctly modeled by this model.
  

---
## Models | `Example: R proficiency as a function of beer`
.center[ .large[How can we solve this? ] ]
Several possibilities (and we will discuss other common ones later), but one way is:

.pull-left-50[

* Create a *new* model taking this into account, where we let
  + we assume higher body mass gives less alcohol susceptibility (lower `\(k\)`)
  + for simplicity, assume also that lower body mass have lower initial proficiency (lower `\(c\)`).

* This will be a "hierarchical model" with:
  + a main linear model `$$y=kx+c,$$` whose parameters are modeled by
  + linear submodels `\(k=f(mass)\)` and `\(c=f(mass)\)`
]

--

.pull-right-50[
&lt;img src="presentation1_files/figure-html/beer2-1.svg" style="display: block; margin: auto auto auto 0;" /&gt;
]
--

Still not quite right...


---

## Models | `Example`
.pull-left-50[  
More realistic?
&lt;img src="presentation1_files/figure-html/beer3-1.svg" style="display: block; margin: auto auto auto 0;" /&gt;

This is a logistic model `\(y = \frac{1}{1-e^{-kx+c}} \Leftrightarrow \log\frac{y}{1+y} = kx+c\)`, where there are saturation towards the extremes
]

--
.pull-right-50[  
* Models can also be described as a graph ('graph models'):
  + This is a graph model showing whether it is possible to fly to RaukR from a selection of cities of the world

&lt;img src="presentation1_files/figure-html/models1-1.svg" style="display: block; margin: auto auto auto 0;" /&gt;


]

---

name: models3

* model structure vs. model parameters (also observation space!?)

---

# But what can models be used for?

Perform 
## Task | `Simulation`
## Task | `Probability of data`
## Task | `Statistical test`

---
name: Simulation1

## Task | `Simulation`

`\(y = \beta_1* x + \beta_0\)` is a *generating* model -- it describes how to generate `\(y\)` from observed `\(x\)` and parameters `\(k,c\)`.

* Generate 100 samples of `\(x,y\)` by
  - generate 100 genotypes `\(x\)` from a uniform distribution on integers `\(0,1,2\)` (tip: use `runif`)
  - set `\(\beta_0=0.3\)` and `\(\beta_0=0.3\)`
  - generate `\(y\)` using the  model `\(y = \sim \beta_1* x + \beta_0\)`
  - plot `\(y\)` against `\(x\)`.

.pull-left-50[

```r
#parameters
b0 = 0.3
b1 = 0.2
N=100
sim1 = data.frame(genos=round(runif(N,min=0,max=2)))

sim1$phenos = b0 + b1 * sim1$genos

plot(x=sim1$genos, y=sim1$phenos)
```
]

.pull-right-50[
&lt;img src="presentation1_files/figure-html/unnamed-chunk-4-1.svg" style="display: block; margin: auto auto auto 0;" /&gt;
]

---
name: Simulation2

## Task | `Simulation`

### Deterministic vs statistical models
* `\(y = \beta_1* x + \beta_0\)` is a *deterministic* model
    + does not model any variation
    + Common, e.g., in classical physics ( `\(E=mc^3\)` )
* `\(y = \beta_1* x + \beta_0 +\epsilon,\)` where `\(\epsilon ~\sim N(0,\sigma^2)\)` is a *statistical* (equiv. *stochastic*, *random*) model
    + attempts to model variation around a population mean (the *residuals*) determined by the model
    + used in statistic analysis

.pull-left-50[

```r
#parameters
b0 = 0.3
b1 = 0.2
N=100
sim1 = data.frame(genos=round(runif(N,min=0,max=2)))

sim1$phenos = b0 + b1 * sim1$genos + rnorm(N, mean=0, sd=0.05) 

plot(x=sim1$genos, y=sim1$phenos)
```
]

.pull-right-50[
&lt;img src="presentation1_files/figure-html/unnamed-chunk-6-1.svg" style="display: block; margin: auto auto auto 0;" /&gt;
]

---
name: Probability1

## Task | `Probability of observed data`

For the linear model `$$Y=\beta_0+\beta_1 X,$$` with parameters `\((\beta_0=0.3, \beta_1=0.2, \sigma^2=0.05\)`), estimate `$$Pr[Y &lt;= 0.6|x=2].$$` 

### Simulation
* simulate 1000 `\(y\)` using the model above with `\(x=2\)` and store in a vector `\(Y\)`.
* Make a histogram of `\(Y\)` and estimate (*tip*: make sure that `\(0.7\)` is among to a histogram breakpoints)

.pull-left-50[

```r
#parameters
b0 = 0.3
b1 = 0.2
N = 1000
x = 2

y = b0 + b1 * x + rnorm(N, mean=0, sd=0.05) 

h=hist(y, frequency=TRUE, right=FALSE, breaks=seq(0,1.0, 0.1), ylim =c(0,1000), labels=TRUE)

# compute requested probability from hist
paste("Pr[Y&lt;=0.6|X=2] = ",sum(h$counts[1:6])/N)
```
]
.pull-right-50[

```
## [1] "Pr[Y&lt;=0.6|X=2] =  0.015"
```

&lt;img src="presentation1_files/figure-html/unnamed-chunk-8-1.svg" style="display: block; margin: auto auto auto 0;" /&gt;
]

---
name: Probability2

## Task | `Probability of observed data`

### Analytic solution | `challenge`
* Translate the requested interval of `\(y\)` values to an interval of residuals
* Calculate the probability of the residual interval using the probability distribution for the Normal distribution (tip: look up help for `Normal`)
    + The distribution function of the vale `\(y\)` is the probability that the stochastic variable `\(Y&lt;=y\)`. *(Memo: introduce stochastic variable better and we need som plot explaining the probaility distribution)*


```r
b0 = 0.3
b1 = 0.2
y = 0.6

res = y - (b0 + b1 * x) 
paste("residuals = ",res)

paste("Pr[Y&lt;=.6|X=2] = ",pnorm(res, sd=0.05))
```

```
## [1] "residuals =  -0.1"
## [1] "Pr[Y&lt;=.6|X=2] =  0.0227501319481792"
```

* *Challenge*: try both approaches with other values of `\(y\)` or try to compute `\(Pr[Y&gt;y|X=2]\)`.
---
name: tests
## Task | `Statistical tests`

We will now consider an extension of the previous task to several data points. 

As you can imagine, doing this with the above approach could be cumbersome. 

Instead specific tests have been developed. 

### Student's t-test
Uses normalized residuals as a test statistics:

`\begin{eqnarray*}
t  
&amp;= \sum_{i}\frac{x_i-\mu}{s/\sqrt{N}} 
&amp;= \frac{\bar{x}-\mu}{s/\sqrt{N}}
\end{eqnarray*}`
where `\(s\)` is the estimated standard deviation from the observed data. 

As you can see this boils down to comparing the (standardized) estimated mean from the data, `\(\bar{x}\)` and the model mean, `\(\mu\)`. (*Challenge*: show the equality above)

Conveniently, The *t*-test is implemented in the R function `t-test`
---
name: tests
## Task | `Statistical tests`

* For simplicity, we will limit ourselves to the case `\(x=2\)` (else *t*-test does not work -- handle this better)
* Perform a one sample t-test using `\(\mu\)` from our original linear model, above, on new data simulated from a linear model with different parameters.
* *Challenge*: Try to use other parameters when simulating the new data.

.pull-left-50[

```r
# compute the mean, mu, from our model 
b0 = 0.3
b1 = 0.2
x = 2
mu = b0 + b1 * x

# Let's simulate the data from another model
b0 = 0.1
b1 = 0.5
N=100
y = b0 + b1 * rep(x,100) + rnorm(N, mean=0, sd=0.05) 
# t-test
t.test(y, mu=mu)
```
]


.pull-right-50[

```
## 
## 	One Sample t-test
## 
## data:  y
## t = 85.18, df = 99, p-value &lt; 2.2e-16
## alternative hypothesis: true mean is not equal to 0.7
## 95 percent confidence interval:
##  1.097863 1.116841
## sample estimates:
## mean of x 
##  1.107352
```
&lt;br&gt;
&lt;br&gt;
]     

.pull-left-50[

* In `lm`, a *t*-test is used to test if the estimated parameters are significantly different from 0. (mention NULL hypothse earlier)


```r
summary(lm(phenos~genos, data=sim1))
```
]
.pull-right-50[

```
## 
## Call:
## lm(formula = phenos ~ genos, data = sim1)
## 
## Residuals:
##       Min        1Q    Median        3Q       Max 
## -0.120050 -0.034706  0.001331  0.032762  0.119969 
## 
## Coefficients:
##             Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept) 0.297696   0.008127   36.63   &lt;2e-16 ***
## genos       0.204220   0.007101   28.76   &lt;2e-16 ***
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
## 
## Residual standard error: 0.04738 on 98 degrees of freedom
## Multiple R-squared:  0.8941,	Adjusted R-squared:  0.893 
## F-statistic: 827.1 on 1 and 98 DF,  p-value: &lt; 2.2e-16
```
]

---
name: nonparam
## Parametric vs Non-parametric tests

The test we have used above are parametric, i.e., they are based on a parameterized model, e.g., the *t*-test assumes an underlying Normal distribution.

There are also non-parametric tests.

* definition of non-parametric tests a bit unclear
  - assumes model structure, but not params, or
  - assumes no model structure and no parameters
* non-parametric tests
  - often based on ranks of values are
  - often tests if two samples are simlar or significantly different

---
name: report

## Session  

* This presentation was created in RStudio using [`remarkjs`](https://github.com/gnab/remark) framework through R package [`xaringan`](https://github.com/yihui/xaringan).
* For R Markdown, see &lt;http://rmarkdown.rstudio.com&gt;
* For R Markdown presentations, see &lt;https://rmarkdown.rstudio.com/lesson-11.html&gt;


```r
R.version
```

```
##                _                           
## platform       x86_64-apple-darwin15.6.0   
## arch           x86_64                      
## os             darwin15.6.0                
## system         x86_64, darwin15.6.0        
## status                                     
## major          3                           
## minor          5.3                         
## year           2019                        
## month          03                          
## day            11                          
## svn rev        76217                       
## language       R                           
## version.string R version 3.5.3 (2019-03-11)
## nickname       Great Truth
```

---
name: end-slide
class: end-slide

# Thank you. Questions?
&lt;!-- --------------------- Do not edit this and below --------------------- --&gt;

---
name: end-slide
class: end-slide, middle
count: false

# Thank you. Questions?


&lt;p&gt;R version 3.5.3 (2019-03-11)&lt;br&gt;&lt;p&gt;Platform: x86_64-apple-darwin15.6.0 (64-bit)&lt;/p&gt;&lt;p&gt;OS: macOS High Sierra 10.13.6&lt;/p&gt;&lt;br&gt;

Built on : &lt;i class='fa fa-calendar' aria-hidden='true'&gt;&lt;/i&gt; 04-Jun-2019 at &lt;i class='fa fa-clock-o' aria-hidden='true'&gt;&lt;/i&gt; 13:39:19  

__2019__ â€¢ [SciLifeLab](https://www.scilifelab.se/) â€¢ [NBIS](https://nbis.se/)
    </textarea>
<style data-target="print-only">@media screen {.remark-slide-container{display:block;}.remark-slide-scaler{box-shadow:none;}}</style>
<script src="assets/remark-latest.min.js"></script>
<script>var slideshow = remark.create({
"ratio": "4:3",
"highlightLanguage": "r",
"highlightStyle": "github",
"highlightLines": true,
"countIncrementalSlides": false,
"slideNumberFormat": "RaukR 2019 â€¢ %current%/%total%"
});
if (window.HTMLWidgets) slideshow.on('afterShowSlide', function (slide) {
  window.dispatchEvent(new Event('resize'));
});
(function(d) {
  var s = d.createElement("style"), r = d.querySelector(".remark-slide-scaler");
  if (!r) return;
  s.type = "text/css"; s.innerHTML = "@page {size: " + r.style.width + " " + r.style.height +"; }";
  d.head.appendChild(s);
})(document);

(function(d) {
  var el = d.getElementsByClassName("remark-slides-area");
  if (!el) return;
  var slide, slides = slideshow.getSlides(), els = el[0].children;
  for (var i = 1; i < slides.length; i++) {
    slide = slides[i];
    if (slide.properties.continued === "true" || slide.properties.count === "false") {
      els[i - 1].className += ' has-continuation';
    }
  }
  var s = d.createElement("style");
  s.type = "text/css"; s.innerHTML = "@media print { .has-continuation { display: none; } }";
  d.head.appendChild(s);
})(document);
// delete the temporary CSS (for displaying all slides initially) when the user
// starts to view slides
(function() {
  var deleted = false;
  slideshow.on('beforeShowSlide', function(slide) {
    if (deleted) return;
    var sheets = document.styleSheets, node;
    for (var i = 0; i < sheets.length; i++) {
      node = sheets[i].ownerNode;
      if (node.dataset["target"] !== "print-only") continue;
      node.parentNode.removeChild(node);
    }
    deleted = true;
  });
})();</script>

<script>
(function() {
  var links = document.getElementsByTagName('a');
  for (var i = 0; i < links.length; i++) {
    if (/^(https?:)?\/\//.test(links[i].getAttribute('href'))) {
      links[i].target = '_blank';
    }
  }
})();
</script>

<script>
slideshow._releaseMath = function(el) {
  var i, text, code, codes = el.getElementsByTagName('code');
  for (i = 0; i < codes.length;) {
    code = codes[i];
    if (code.parentNode.tagName !== 'PRE' && code.childElementCount === 0) {
      text = code.textContent;
      if (/^\\\((.|\s)+\\\)$/.test(text) || /^\\\[(.|\s)+\\\]$/.test(text) ||
          /^\$\$(.|\s)+\$\$$/.test(text) ||
          /^\\begin\{([^}]+)\}(.|\s)+\\end\{[^}]+\}$/.test(text)) {
        code.outerHTML = code.innerHTML;  // remove <code></code>
        continue;
      }
    }
    i++;
  }
};
slideshow._releaseMath(document);
</script>
<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
(function () {
  var script = document.createElement('script');
  script.type = 'text/javascript';
  script.src  = 'https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML';
  if (location.protocol !== 'file:' && /^https?:/.test(script.src))
    script.src  = script.src.replace(/^https?:/, '');
  document.getElementsByTagName('head')[0].appendChild(script);
})();
</script>
  </body>
</html>
